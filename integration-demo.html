<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shadow DOM Survey Components Demo</title>
    <style>
      :root {
        --primary: #4f46e5;
        --primary-dark: #4338ca;
        --accent: #10b981;
        --accent-dark: #059669;
        --error: #ef4444;
        --success: #10b981;
        --gray-50: #f9fafb;
        --gray-100: #f3f4f6;
        --gray-200: #e5e7eb;
        --gray-300: #d1d5db;
        --gray-500: #6b7280;
        --gray-700: #374151;
        --gray-800: #1f2937;
        --gray-900: #111827;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Helvetica, Arial, sans-serif;
        line-height: 1.5;
        background-color: var(--gray-100);
        color: var(--gray-800);
        margin: 0;
        padding: 0;
      }

      .app-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem 1rem;
      }

      .header {
        text-align: center;
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--gray-200);
      }

      .header h1 {
        color: var(--primary);
        margin-bottom: 0.5rem;
      }

      .header p {
        color: var(--gray-500);
        font-size: 1.125rem;
        max-width: 800px;
        margin: 0 auto;
      }

      .demo-container {
        display: grid;
        grid-template-columns: 1fr;
        gap: 2rem;
      }

      @media (min-width: 1024px) {
        .demo-container {
          grid-template-columns: 1fr 1fr;
        }
      }

      .component-card {
        background-color: white;
        border-radius: 0.5rem;
        overflow: hidden;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .card-header {
        background-color: var(--gray-800);
        color: white;
        padding: 1rem 1.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .card-header h2 {
        margin: 0;
        font-size: 1.25rem;
      }

      .card-body {
        padding: 1.5rem;
        min-height: 300px;
      }

      .card-footer {
        padding: 1rem 1.5rem;
        background-color: var(--gray-50);
        border-top: 1px solid var(--gray-200);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .btn {
        display: inline-block;
        padding: 0.5rem 1rem;
        font-weight: 500;
        text-align: center;
        border: none;
        border-radius: 0.375rem;
        cursor: pointer;
        transition: background-color 0.15s, transform 0.15s;
      }

      .btn:hover {
        transform: translateY(-1px);
      }

      .btn:active {
        transform: translateY(0);
      }

      .btn-primary {
        background-color: var(--primary);
        color: white;
      }

      .btn-primary:hover {
        background-color: var(--primary-dark);
      }

      .btn-secondary {
        background-color: white;
        border: 1px solid var(--gray-300);
        color: var(--gray-700);
      }

      .btn-secondary:hover {
        background-color: var(--gray-50);
      }

      .btn-accent {
        background-color: var(--accent);
        color: white;
      }

      .btn-accent:hover {
        background-color: var(--accent-dark);
      }

      .badge {
        display: inline-block;
        padding: 0.25rem 0.5rem;
        font-size: 0.75rem;
        font-weight: 600;
        border-radius: 9999px;
      }

      .badge-success {
        background-color: var(--success);
        color: white;
      }

      .badge-waiting {
        background-color: var(--gray-500);
        color: white;
      }

      .section-tabs {
        display: flex;
        border-bottom: 1px solid var(--gray-200);
        margin-bottom: 1.5rem;
      }

      .section-tab {
        padding: 0.5rem 1rem;
        cursor: pointer;
        border-bottom: 2px solid transparent;
        margin-right: 1rem;
        color: var(--gray-500);
        font-weight: 500;
      }

      .section-tab.active {
        color: var(--primary);
        border-bottom-color: var(--primary);
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .card-placeholder {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 200px;
        background-color: var(--gray-50);
        border: 2px dashed var(--gray-300);
        border-radius: 0.5rem;
        padding: 1.5rem;
        text-align: center;
        color: var(--gray-500);
      }

      .workflow-steps {
        display: flex;
        justify-content: space-between;
        margin-bottom: 2rem;
        position: relative;
        padding: 0 1rem;
      }

      .workflow-steps::before {
        content: "";
        position: absolute;
        top: 24px;
        left: 50px;
        right: 50px;
        height: 2px;
        background-color: var(--gray-300);
        z-index: 0;
      }

      .workflow-step {
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
        z-index: 1;
      }

      .step-circle {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background-color: var(--gray-200);
        color: var(--gray-500);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        margin-bottom: 0.5rem;
      }

      .step-circle.active {
        background-color: var(--primary);
        color: white;
      }

      .step-circle.completed {
        background-color: var(--success);
        color: white;
      }

      .step-label {
        font-size: 0.875rem;
        color: var(--gray-700);
        font-weight: 500;
      }

      .survey-data {
        background-color: var(--gray-50);
        border: 1px solid var(--gray-200);
        border-radius: 0.5rem;
        padding: 1rem;
        font-family: monospace;
        font-size: 0.875rem;
        overflow: auto;
        max-height: 200px;
      }

      .survey-response {
        background-color: var(--gray-50);
        border: 1px solid var(--gray-200);
        border-radius: 0.5rem;
        padding: 1rem;
        margin-top: 1rem;
      }

      .response-item {
        margin-bottom: 0.5rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid var(--gray-200);
      }

      .language-toggle {
        display: flex;
        justify-content: center;
        margin-bottom: 1.5rem;
      }

      .language-btn {
        padding: 0.5rem 1rem;
        margin: 0 0.5rem;
        border: 1px solid var(--gray-300);
        background-color: white;
        border-radius: 0.375rem;
        cursor: pointer;
        font-weight: 500;
      }

      .language-btn.active {
        background-color: var(--primary);
        color: white;
        border-color: var(--primary);
      }
    </style>
  </head>
  <body>
    <div class="app-container">
      <div class="header">
        <h1>Shadow DOM Survey System Demo</h1>
        <p>
          A complete survey system with builder and reader components, built
          with Shadow DOM for encapsulation.
        </p>
      </div>

      <div class="language-toggle">
        <button id="lang-en" class="language-btn">English</button>
        <button id="lang-ar" class="language-btn active">العربية</button>
      </div>

      <div class="workflow-steps">
        <div class="workflow-step">
          <div class="step-circle active" id="step-1">1</div>
          <div class="step-label" id="step-1-label">Create Survey</div>
        </div>
        <div class="workflow-step">
          <div class="step-circle" id="step-2">2</div>
          <div class="step-label" id="step-2-label">Preview Survey</div>
        </div>
        <div class="workflow-step">
          <div class="step-circle" id="step-3">3</div>
          <div class="step-label" id="step-3-label">Collect Responses</div>
        </div>
      </div>

      <div class="demo-container">
        <!-- Builder Component -->
        <div class="component-card">
          <div class="card-header">
            <h2 id="builder-title">Survey Builder</h2>
            <span class="badge badge-success">Active</span>
          </div>
          <div class="card-body">
            <div id="surveyBuilder"></div>
          </div>
          <div class="card-footer">
            <p id="builder-tip">
              <strong>Tip:</strong> Use the builder to create a survey with
              different question types. When done, save it to preview.
            </p>
          </div>
        </div>

        <!-- Reader Component -->
        <div class="component-card">
          <div class="card-header">
            <h2 id="reader-title">Survey Reader</h2>
            <span class="badge badge-waiting" id="reader-status"
              >Waiting for Survey</span
            >
          </div>
          <div class="card-body">
            <div class="section-tabs">
              <div
                class="section-tab active"
                data-tab="preview"
                id="tab-preview"
              >
                Preview
              </div>
              <div class="section-tab" data-tab="responses" id="tab-responses">
                Responses
              </div>
              <div class="section-tab" data-tab="data" id="tab-data">
                Survey Data
              </div>
            </div>

            <div class="tab-content active" data-tab="preview">
              <div id="surveyReader">
                <div class="card-placeholder" id="reader-placeholder">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="48"
                    height="48"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="1"
                      d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                    />
                  </svg>
                  <p id="reader-placeholder-text">
                    Create and save a survey using<br />the builder to preview
                    it here
                  </p>
                </div>
              </div>
            </div>

            <div class="tab-content" data-tab="responses">
              <div id="survey-responses">
                <div class="card-placeholder">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="48"
                    height="48"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="1"
                      d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
                    />
                  </svg>
                  <p id="responses-placeholder-text">
                    Submit the survey to see<br />responses appear here
                  </p>
                </div>
              </div>
            </div>

            <div class="tab-content" data-tab="data">
              <div id="survey-data" class="survey-data">
                No survey data available yet.
              </div>
            </div>
          </div>
          <div class="card-footer">
            <button id="reset-demo" class="btn btn-secondary">
              <span id="reset-text">Reset Demo</span>
            </button>
            <button id="copy-data" class="btn btn-accent">
              <span id="copy-text">Copy Survey Data</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Include Shadow DOM Survey Components -->
    <script src="builder-embed/builder-embed.js"></script>
    <script src="reader-embed/reader-embed.js"></script>

    <script>
      // Store survey data and responses
      let currentSurveyData = null;
      let surveyResponses = [];
      let isEnglish = false;

      // Keep references to component instances for proper cleanup
      let builderInstance = null;
      let readerInstance = null;

      // Language translations
      const translations = {
        en: {
          step1: "Create Survey",
          step2: "Preview Survey",
          step3: "Collect Responses",
          builderTitle: "Survey Builder",
          readerTitle: "Survey Reader",
          builderTip:
            "<strong>Tip:</strong> Use the builder to create a survey with different question types. When done, save it to preview.",
          tabPreview: "Preview",
          tabResponses: "Responses",
          tabData: "Survey Data",
          readerPlaceholder:
            "Create and save a survey using<br>the builder to preview it here",
          responsesPlaceholder:
            "Submit the survey to see<br>responses appear here",
          resetText: "Reset Demo",
          copyText: "Copy Survey Data",
          waitingStatus: "Waiting for Survey",
          readyStatus: "Preview Ready",
          noData: "No survey data available yet.",
          copiedMessage: "Survey data copied to clipboard!",
          resetConfirm:
            "Are you sure you want to reset the demo? This will clear all survey data and responses.",
          responseTitle: "Response #",
          responseDateLabel: "Date: ",
          responseQuestionLabel: "Question: ",
          responseAnswerLabel: "Answer: ",
          responsesTitle: "Responses",
        },
        ar: {
          step1: "إنشاء استبيان",
          step2: "معاينة الاستبيان",
          step3: "جمع الردود",
          builderTitle: "منشئ الاستبيان",
          readerTitle: "قارئ الاستبيان",
          builderTip:
            "<strong>نصيحة:</strong> استخدم منشئ الاستبيان لإنشاء استبيان بأنواع أسئلة مختلفة. عند الانتهاء، احفظه للمعاينة.",
          tabPreview: "معاينة",
          tabResponses: "الردود",
          tabData: "بيانات الاستبيان",
          readerPlaceholder:
            "قم بإنشاء وحفظ استبيان باستخدام<br>منشئ الاستبيان لمعاينته هنا",
          responsesPlaceholder: "أرسل الاستبيان لرؤية<br>الردود تظهر هنا",
          resetText: "إعادة ضبط العرض",
          copyText: "نسخ بيانات الاستبيان",
          waitingStatus: "في انتظار الاستبيان",
          readyStatus: "المعاينة جاهزة",
          noData: "لا توجد بيانات استبيان متاحة بعد.",
          copiedMessage: "تم نسخ بيانات الاستبيان إلى الحافظة!",
          resetConfirm:
            "هل أنت متأكد أنك تريد إعادة ضبط العرض؟ سيؤدي هذا إلى مسح جميع بيانات الاستبيان والردود.",
          responseTitle: "الرد #",
          responseDateLabel: "التاريخ: ",
          responseQuestionLabel: "السؤال: ",
          responseAnswerLabel: "الإجابة: ",
          responsesTitle: "الردود",
        },
      };

      // Update UI language
      function updateLanguage(isEn) {
        isEnglish = isEn;
        const lang = isEnglish ? "en" : "ar";
        document.documentElement.lang = lang;
        document.documentElement.dir = isEnglish ? "ltr" : "rtl";

        // Update language toggle buttons
        document
          .getElementById("lang-en")
          .classList.toggle("active", isEnglish);
        document
          .getElementById("lang-ar")
          .classList.toggle("active", !isEnglish);

        // Update texts
        document.getElementById("step-1-label").textContent =
          translations[lang].step1;
        document.getElementById("step-2-label").textContent =
          translations[lang].step2;
        document.getElementById("step-3-label").textContent =
          translations[lang].step3;
        document.getElementById("builder-title").textContent =
          translations[lang].builderTitle;
        document.getElementById("reader-title").textContent =
          translations[lang].readerTitle;
        document.getElementById("builder-tip").innerHTML =
          translations[lang].builderTip;
        document.getElementById("tab-preview").textContent =
          translations[lang].tabPreview;
        document.getElementById("tab-responses").textContent =
          translations[lang].tabResponses;
        document.getElementById("tab-data").textContent =
          translations[lang].tabData;
        document.getElementById("reader-placeholder-text").innerHTML =
          translations[lang].readerPlaceholder;
        document.getElementById("responses-placeholder-text").innerHTML =
          translations[lang].responsesPlaceholder;
        document.getElementById("reset-text").textContent =
          translations[lang].resetText;
        document.getElementById("copy-text").textContent =
          translations[lang].copyText;

        // Update status badges if needed
        const readerStatus = document.getElementById("reader-status");
        if (readerStatus.classList.contains("badge-waiting")) {
          readerStatus.textContent = translations[lang].waitingStatus;
        } else {
          readerStatus.textContent = translations[lang].readyStatus;
        }

        // Update survey data text if empty
        const surveyDataEl = document.getElementById("survey-data");
        if (!currentSurveyData) {
          surveyDataEl.textContent = translations[lang].noData;
        }

        // Reinitialize components if necessary
        if (currentSurveyData === null) {
          // Only initialize the builder if it doesn't exist
          if (!builderInstance) {
            initializeBuilder();
          } else {
            // If the builder exists, just destroy and recreate it with the new language
            builderInstance.destroy();
            builderInstance = null;
            initializeBuilder();
          }
        } else {
          // Update reader if it exists
          if (readerInstance) {
            readerInstance.destroy();
            readerInstance = null;
            initializeReader();
          }

          // Just update responses view if there are any
          if (surveyResponses.length > 0) {
            updateResponsesView();
          }
        }
      }

      // Update workflow step indicator
      function updateWorkflowStep(step) {
        document.querySelectorAll(".step-circle").forEach((circle) => {
          circle.classList.remove("active", "completed");
        });

        for (let i = 1; i < step; i++) {
          document.getElementById(`step-${i}`).classList.add("completed");
        }
        document.getElementById(`step-${step}`).classList.add("active");
      }

      // Initialize the Survey Builder
      function initializeBuilder() {
        // Clean up previous builder instance if exists
        if (builderInstance) {
          builderInstance.destroy();
          builderInstance = null;
        }

        // Clear previous builder if any
        const builderContainer = document.getElementById("surveyBuilder");
        builderContainer.innerHTML = "";

        // Initialize new builder
        builderInstance = new SurveyBuilder("#surveyBuilder", {
          onSave: async (data) => {
            console.log("Survey saved:", data);

            // Store survey data
            currentSurveyData = data;

            // Update data view
            document.getElementById("survey-data").textContent = JSON.stringify(
              data,
              null,
              2
            );

            // Initialize reader with the survey data
            initializeReader();

            // Update workflow step
            updateWorkflowStep(2);

            // Update reader status
            const readerStatus = document.getElementById("reader-status");
            readerStatus.textContent = isEnglish
              ? translations.en.readyStatus
              : translations.ar.readyStatus;
            readerStatus.classList.remove("badge-waiting");
            readerStatus.classList.add("badge-success");

            // Hide placeholder - but check if it exists first
            const placeholder = document.getElementById("reader-placeholder");
            if (placeholder) {
              placeholder.style.display = "none";
            }

            return data;
          },
          isEnglish: isEnglish,
        });
      }

      // Initialize the Survey Reader with the survey data
      function initializeReader() {
        if (!currentSurveyData) return;

        // Clean up previous reader instance if exists
        if (readerInstance) {
          readerInstance.destroy();
          readerInstance = null;
        }

        const readerContainer = document.getElementById("surveyReader");
        readerContainer.innerHTML = ""; // Clear previous reader HTML content

        // Initialize new survey reader
        readerInstance = new SurveyReader("#surveyReader", {
          surveyData: currentSurveyData,
          onSubmit: async (response) => {
            console.log("Survey response:", response);

            // Store response
            surveyResponses.push({
              id: Date.now(),
              data: response,
              timestamp: new Date().toISOString(),
            });

            // Update responses view
            updateResponsesView();

            // Switch to responses tab
            setTimeout(() => {
              document
                .querySelector('.section-tab[data-tab="responses"]')
                .click();
            }, 1500);

            // Update workflow step
            updateWorkflowStep(3);

            return response;
          },
          completedTitle: isEnglish ? "Thank You!" : "شكراً لك!",
          completedMessage: isEnglish
            ? "Your response has been recorded."
            : "تم تسجيل إجابتك.",
          submitButtonText: isEnglish ? "Submit Your Answers" : "إرسال إجاباتك",
          requiredFieldMessage: isEnglish
            ? "This question requires an answer"
            : "هذا السؤال يتطلب إجابة",
          isEnglish: isEnglish,
        });
      }

      // Update responses view
      function updateResponsesView() {
        const responsesContainer = document.getElementById("survey-responses");
        const lang = isEnglish ? "en" : "ar";

        if (surveyResponses.length === 0) {
          responsesContainer.innerHTML = `
          <div class="card-placeholder">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
            </svg>
            <p>${translations[lang].responsesPlaceholder}</p>
          </div>
        `;
          return;
        }

        let responsesHTML = `<h3>${translations[lang].responsesTitle} (${surveyResponses.length})</h3>`;

        surveyResponses.forEach((response, index) => {
          const responseData = response.data;
          const date = new Date(response.timestamp).toLocaleString();

          responsesHTML += `
          <div class="survey-response">
            <div class="response-item">
              <strong>${translations[lang].responseTitle}${
            index + 1
          }</strong> - ${date}
            </div>
            <div class="response-item">
              <strong>${translations[lang].responseQuestionLabel}</strong> ${
            responseData.questionText
          }
            </div>
            <div class="response-item">
              <strong>${
                translations[lang].responseAnswerLabel
              }</strong> ${formatAnswer(responseData.response)}
            </div>
          </div>
        `;
        });

        responsesContainer.innerHTML = responsesHTML;
      }

      // Format answer for display
      function formatAnswer(answer) {
        if (answer === undefined || answer === null) {
          return "No answer provided";
        }

        if (typeof answer === "object") {
          if (Array.isArray(answer)) {
            return answer.join(", ");
          } else if (answer.matrix) {
            // Matrix question
            let result = '<ul style="margin: 0; padding-left: 20px;">';
            for (const [row, value] of Object.entries(answer.matrix)) {
              result += `<li>${row}: ${value}</li>`;
            }
            result += "</ul>";
            return result;
          }
          return JSON.stringify(answer);
        }

        return answer.toString();
      }

      // Tab functionality
      document.querySelectorAll(".section-tab").forEach((tab) => {
        tab.addEventListener("click", function () {
          // Remove active class from all tabs
          document
            .querySelectorAll(".section-tab")
            .forEach((t) => t.classList.remove("active"));
          document
            .querySelectorAll(".tab-content")
            .forEach((c) => c.classList.remove("active"));

          // Add active class to current tab
          this.classList.add("active");

          // Show corresponding content
          const tabName = this.getAttribute("data-tab");
          document
            .querySelector(`.tab-content[data-tab="${tabName}"]`)
            .classList.add("active");
        });
      });

      // Reset demo button
      document
        .getElementById("reset-demo")
        .addEventListener("click", function () {
          const confirmMessage = isEnglish
            ? translations.en.resetConfirm
            : translations.ar.resetConfirm;

          if (confirm(confirmMessage)) {
            // Reset survey data and responses
            currentSurveyData = null;
            surveyResponses = [];

            // Clean up existing component instances
            if (readerInstance) {
              readerInstance.destroy();
              readerInstance = null;
            }

            // Reset reader placeholder
            document.getElementById("surveyReader").innerHTML = `
            <div class="card-placeholder" id="reader-placeholder">
              <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
              </svg>
              <p>${
                isEnglish
                  ? translations.en.readerPlaceholder
                  : translations.ar.readerPlaceholder
              }</p>
            </div>
          `;

            // Reset data view
            document.getElementById("survey-data").textContent = isEnglish
              ? translations.en.noData
              : translations.ar.noData;

            // Reset responses view
            updateResponsesView();

            // Reset reader status
            const readerStatus = document.getElementById("reader-status");
            readerStatus.textContent = isEnglish
              ? translations.en.waitingStatus
              : translations.ar.waitingStatus;
            readerStatus.classList.remove("badge-success");
            readerStatus.classList.add("badge-waiting");

            // Clean up builder instance
            if (builderInstance) {
              builderInstance.destroy();
              builderInstance = null;
            }

            // Reinitialize builder
            initializeBuilder();

            // Reset workflow step
            updateWorkflowStep(1);

            // Switch to preview tab
            document.querySelector('.section-tab[data-tab="preview"]').click();
          }
        });

      // Copy data button
      document
        .getElementById("copy-data")
        .addEventListener("click", function () {
          if (!currentSurveyData) {
            alert(isEnglish ? translations.en.noData : translations.ar.noData);
            return;
          }

          const textToCopy = JSON.stringify(currentSurveyData, null, 2);

          // Create textarea element to copy from
          const textarea = document.createElement("textarea");
          textarea.value = textToCopy;
          textarea.style.position = "fixed"; // Prevent scrolling to bottom
          document.body.appendChild(textarea);
          textarea.select();

          try {
            // Execute copy command
            const successful = document.execCommand("copy");
            const msg = successful
              ? isEnglish
                ? translations.en.copiedMessage
                : translations.ar.copiedMessage
              : "Unable to copy survey data";
            alert(msg);
          } catch (err) {
            console.error("Error copying survey data:", err);
            alert("Failed to copy survey data to clipboard");
          }

          // Clean up
          document.body.removeChild(textarea);
        });

      // Language toggle
      document.getElementById("lang-en").addEventListener("click", function () {
        if (!isEnglish) {
          updateLanguage(true);
        }
      });

      document.getElementById("lang-ar").addEventListener("click", function () {
        if (isEnglish) {
          updateLanguage(false);
        }
      });

      // Initialize components on page load
      document.addEventListener("DOMContentLoaded", function () {
        // Make sure builderContainer is clean
        const builderContainer = document.getElementById("surveyBuilder");
        if (builderContainer.shadowRoot) {
          // If for some reason it already has a shadow root, clear it
          while (builderContainer.shadowRoot.firstChild) {
            builderContainer.shadowRoot.removeChild(
              builderContainer.shadowRoot.firstChild
            );
          }
          // Unfortunately we can't remove the shadow root itself,
          // but at least we've cleaned its contents
        }

        // Set initial language and initialize builder
        updateLanguage(false); // Start with Arabic by default
      });
    </script>
  </body>
</html>
